<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Toolbox</title>
	
	<link href="../../Commons/Ext/Styles/ext-all.css" rel="Stylesheet" type="text/css" />
	<link href="../../Commons/Ext/Styles/ux-all.css" rel="stylesheet" type="text/css" />
  
  <script src="../../blockly_compressed-format.js"></script>
  <script src="../../blocks_compressed-format.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="../../csharp_compressed.js"></script>
  <script src="../../msg/js/zh-hans.js"></script>
	<script src="../../Commons/Ext/Scripts/ext-base-debug.js"></script>
  <script src="../../Commons/Ext/Scripts/ext-all-debug.js" type="text/javascript"></script>
  <script src="../../Commons/Scripts/Utility/GlobalFunction.source.js" type="text/javascript"></script>
  
	<script src="../../demos/lyf/blocks/basic.js"></script>
	<script src="../../demos/lyf/blocks/window.js"></script>
	<script src="../../demos/lyf/blocks/field.js"></script>
	<script src="../../demos/lyf/blocks/grid.js"></script>
	<script src="../../demos/lyf/blocks/store.js"></script>  
	<script src="../../demos/lyf/blocks/field.js"></script>  
  
   <script type='text/javascript'>

			Ext.onReady(function () {
				
          
      });
  </script>
  
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  

  <div id="blocklyDiv" style="height: 600px; width: 1200px;position:relative"></div>
<!--   	
	<p>
    <button onclick="csd()">csd</button>
    <button onclick="runCode()">Run JavaScript</button>
  </p>

 <div id="shownn" style="height: 600px; width: 800px;">
  	<p>
    <input type="button" value="Export to XML" onclick="toXml()">
    &nbsp;
    <input type="button" value="Import from XML" onclick="fromXml()" id="import">
    <br>
    <textarea id="importExport" style="width: 26%; height: 12em"
      onchange="taChange();" onkeyup="taChange()"></textarea>	
    </p>
  </div>
-->


 <xml id="toolbox" style="display: none">
   <category name="控制语句">
      <category name="判断语句">
        <category name="If">
          <block type="controls_if"></block>
          <block type="controls_if">
            <mutation else="1"></mutation>
          </block>
          <block type="controls_if">
            <mutation elseif="1" else="1"></mutation>
          </block>
        </category>
        <category name="Boolean">
          <block type="logic_compare"></block>
          <block type="logic_operation"></block>
          <block type="logic_negate"></block>
          <block type="logic_boolean"></block>
          <block type="logic_null"></block>
          <block type="logic_ternary"></block>
        </category>
      </category>
      <category name="循环">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
          <field name="VAR">i</field>
          <value name="FROM">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
          <value name="TO">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
          <value name="BY">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
    </category>
    <category name="运算">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="math_single"></block>
      <block type="math_trig"></block>
      <block type="math_constant"></block>
      <block type="math_number_property"></block>
      <block type="math_change">
        <value name="DELTA">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
      </block>
      <block type="math_round"></block>
      <block type="math_on_list"></block>
      <block type="math_modulo"></block>
      <block type="math_constrain">
        <value name="LOW">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
        <value name="HIGH">
          <block type="math_number">
            <field name="NUM">100</field>
          </block>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
        <value name="TO">
          <block type="math_number">
            <field name="NUM">100</field>
          </block>
        </value>
      </block>
      <block type="math_random_float"></block>
    </category>
    <category name="数据">
      <category name="Lists">
        <block type="lists_create_empty"></block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
          <value name="NUM">
            <block type="math_number">
              <field name="NUM">5</field>
            </block>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf"></block>
        <block type="lists_getIndex"></block>
        <block type="lists_setIndex"></block>
      </category>
      <category name="常量">
        <block type="text"></block>
        <block type="math_number">
          <field name="NUM" editable_="false">10</field>
        </block>
      </category>
      <category name="变量" custom="VARIABLE">
      </category>
    </category>
    <category name="基本">
      <block type="openurl"></block>
      <block type="alert"></block>
      <block type="convertstring"></block>
      <block type="convertint"></block>
    </category>
    <sep></sep>
    <category name="Ext" expanded="true">
      <category name="Ext公共方法">
        <block type="ext_getcmp"></block>
        <block type="show"></block>
        <block type="hide"></block>
      </category>
      <category name="Field" expanded="true">
        <category name="TextField">
          <block type="ext_getcmp">
            <field name="cmpid"></field>
            <value name="inputcmp">
              <block type="textsetvalue">
                <field name="v"></field>
              </block>
            </value>
          </block>
          <block type="getvalue"></block>
        </category>
        <category name="NumberField">
          <block type="ext_getcmp">
            <field name="cmpid"></field>
            <value name="inputcmp">
              <block type="numbersetvalue" >
                <value name="v">
                  <block type="math_number">
                    <field name="NUM">0</field>
                  </block>
                </value>
              </block>
            </value>
          </block>
          <block type="getvalue"></block>
        </category>
      </category>
      <category name="Grid操作">
          <block type="gridsum"></block>
          <block type="aftereditparam"></block>
      </category>
      <category name="Store操作">
        <category name="ArraryStore">
          <block type="arraystoreappenddata"></block>
          <block type="arrayrecord_row"></block>
          <block type="arrayfield"></block>
        </category>
        <category name="JsonStore">
          <block type="jsonstoreappenddata"></block>
          <block type="row"></block>
          <block type="field"></block>
          <category name="数据加载">
            <block type="reload"></block>
            <block type="load"></block>
            <block type="params"></block>
            <block type="decimalparam"></block>
            <block type="stringparam"></block>
            <block type="cmpparam"></block>
          </category>
        </category>
      	<category name="公用方法">      	
        	<block type="ext_storemgr"></block>
        </category>
      	<category name="Record">
          <block type="getrecord"></block>
          <block type="getfieldvalue"></block>
          <block type="getfieldvalue_var"></block>
        </category>
      </category>
      <category name="窗体操作">
        <block type="ext_getcmp" >
          <field name="cmpid"></field>
          <value name="inputcmp">
            <block type="center"></block>
          </value>
        </block>
      </category>
      <category name="常用控件">
      </category>
    </category>
    <sep></sep>
    <category name="表单信息">
        <block type="form_var"></block>
        <block type="form_info"></block>
        <block type="form_status"></block>
    </category>
</xml>


  <script>
  	var csd =function (){
  		if(typeof(fxml) != 'undefined')
	    	fromXml(fxml);
  	}
  		
    var workspace = Blockly.inject('blocklyDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox')}
     );
     csd();
    function onchange(event) {   	
    	var b = workspace.getBlockById(event.blockId);
    	//element	string	One of 'selected', 'click', 'commentOpen', 'mutatorOpen', 'warningOpen'
    	if(event instanceof Blockly.Events.Ui && event.element == 'click' && b && (b.type == 'ext_getcmp' || b.type == 'getvalue'))//event.element == 'click' b.type == 'math_number'
    	{
    		if(b.customAdd)
    		{
    			b.customAdd.call(b);	
    		}
//    		window.parent.Ext.getCmp('lg').blockId = event.blockId;
//    		window.parent.Ext.getCmp('lg').show();
//    		b.inputList[0].fieldRow[0].text_ = '2';
//    		b.setFieldValue('3', 'NUM');
//		  	var code = Blockly.JavaScript.workspaceToCode(workspace);
//	  		document.getElementById('zzdx').innerHTML = code;
//	    	event.element = 'click';
	    }
	  }
    workspace.removeChangeListener(onchange);
		workspace.addChangeListener(onchange);
		//onchange();		
  </script>
</body>
</html>
