Ext.grid.VerticalGridview=function(a){Ext.grid.VerticalGridview.superclass.constructor.call(this,a);this.addEvents("columnsummaryupdate")};Ext.extend(Ext.grid.VerticalGridview,Ext.grid.GridView,{headerWidth:200,rowsWidth:80,colsTotalWidth:80,colWidth:23,isColsTotal:true,isRowsTotal:true,enableColumnResize:false,scrollOffset:17,hdCls:"x-grid3-hd",cellSelector:"li.x-grid3-cell",rowSelector:"div.x-grid3-row",initTemplates:function(){var c=this.templates||{};if(!c.master){c.master=new Ext.Template('<div class="x-grid3 x-grid3-vertical" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body">{body}<div class="x-clear"></div></div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',(this.isColsTotal?'<div class="x-grid3-columnsummary"><div class="x-grid3-columnsummary-inner"><div class="x-grid3-columnsummary-offset">{columnsummary}</div></div><div class="x-clear"></div></div>':""),'<div class="x-clear"></div>',(this.isRowsTotal?"{rowsummary}":""),"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")}if(!c.header){c.header=new Ext.Template('<ul class="x-grid3-hd-row" style="{style}">{cells}</ul>')}if(!c.hcell){c.hcell=new Ext.Template('<li class="x-grid3-hd x-grid3-cell x-grid3-li-{id}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{value}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div></li>")}if(!c.body){c.body=new Ext.Template("{rows}")}if(!c.row){c.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}overflow:hidden;">','<ul class="x-grid3-row-ul" style="{tstyle}overflow:hidden;">',"{cells}","</ul>",(this.enableRowBody?'<div class="x-grid3-row-body-ul" style="{bodyStyle}{tstyle}"><div class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></div></div>':""),"</div>")}if(!c.cell){c.cell=new Ext.Template('<li class="x-grid3-col x-grid3-cell x-grid3-li-{id} {css}" style="{style}overflow:hidden;" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</li>")}if(!c.columnSummary){c.columnSummary=new Ext.Template('<ul class="x-grid3-cs-row" style="{cstyle}">{cells}</ul>')}if(!c.columnSummaryCell){c.columnSummaryCell=new Ext.Template('<li class="x-grid3-cs x-grid3-cell x-grid3-cs-{id}" style="{style}"><div {tooltip} {attr} class="x-grid3-cs-inner x-grid3-cs-{id}" unselectable="on">',"{value}","</div></li>")}if(!c.rowSummary){c.rowSummary=new Ext.Template('<div class="x-grid3-rowsummary">','<div class="x-grid3-rs-title">(Totals)</div>','<div class="x-grid3-rowsummary-inner"><div class="x-grid3-rowsummary-offset"><ul class="x-grid3-rs-row" style="{fstyle}">{cells}</ul><div class="x-clear"></div></div></div>','<div class="x-grid3-total">{total}</div>',"</div>")}if(!c.rowSummaryCell){c.rowSummaryCell=new Ext.Template('<li class="x-grid3-rs x-grid3-cell x-grid3-rs-{id}" style="{fstyle}"><div {tooltip} {attr} class="x-grid3-rs-inner x-grid3-rs-{id}" unselectable="on" style="{istyle}">',"{value}","</div></li>")}for(var a in c){var b=c[a];if(b&&typeof b.compile=="function"&&!b.compiled){b.disableFormats=true;b.compile()}}this.templates=c;this.colRe=new RegExp("x-grid3-li-([^\\s]+)","")},initElements:function(){Ext.grid.VerticalGridview.superclass.initElements.call(this);this.mainColumnsummary=new Ext.Element(this.mainWrap.dom.childNodes[2]);this.innerColumnSummary=this.mainColumnsummary.dom.firstChild},findCellIndex:function(c,b){var a=this.findCell(c);if(a&&(!b||this.fly(a).hasClass(b))){return this.getCellIndex(a)}return false},getCell:function(b,a){return this.getRow(b).getElementsByTagName("li")[a]},getHeaderCell:function(a){return this.mainHd.dom.getElementsByTagName("li")[a]},updateAllColumnWidths:function(){var d=this.getTotalWidth();var h=this.cm.getColumnCount();var f=[];for(var b=0;b<h;b++){f[b]=this.getColumnWidth(b)}this.innerHd.firstChild.firstChild.style.width=d;for(var b=0;b<h;b++){var c=this.getHeaderCell(b);c.style.width=f[b]}var g=this.getRows();for(var b=0,e=g.length;b<e;b++){g[b].style.width=d;g[b].firstChild.style.width=d;var k=g[b].firstChild;for(var a=0;a<h;a++){k.childNodes[a].style.width=f[a]}}this.onAllColumnWidthsUpdated(f,d)},updateColumnWidth:function(d,g){var b=this.getColumnWidth(d);var c=this.getTotalWidth();this.innerHd.firstChild.firstChild.style.width=c;var h=this.getHeaderCell(d);h.style.width=c;var f=this.getRows();for(var e=0,a=f.length;e<a;e++){f[e].style.width=b;f[e].firstChild.style.width=b;f[e].firstChild.childNodes[d].style.width=b}this.onColumnWidthUpdated(d,b,c)},updateColumnHidden:function(c,f){var b=this.getTotalWidth();this.innerHd.firstChild.firstChild.style.width=b;var h=f?"none":"";var g=this.getHeaderCell(c);g.style.display=h;var e=this.getRows();b=this.getColumnWidth();for(var d=0,a=e.length;d<a;d++){e[d].style.width=b;e[d].firstChild.style.width=b;e[d].firstChild.childNodes[c].style.display=h}this.onColumnHiddenUpdated(c,f,b);delete this.lastViewWidth;this.layout()},afterRender:function(){this.mainBody.dom.innerHTML=this.renderRows();this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.doColumnsSummary()},doColumnsSummary:function(){var d=this.grid.store;var a=d.getRange(0,d.getCount()-1);var b=this.getColumnData();var c=this.calculate(a,b);this.innerColumnSummary.firstChild.innerHTML=this.renderColumnsSummary({data:c},b);this.fireEvent("columnsummaryupdate",this,c,b);return true},calculate:function(d,k){var g={},a,m,l=this.cm.config,b;if(d.length>0){for(var e=0,n=d.length;e<n;e++){a=d[e];for(var f=0,h=k.length;f<h;f++){m=k[f];b=l[f];if(b.summaryType){g[m.name]=Ext.grid.GroupSummary.Calculations[b.summaryType](g[m.name]||0,a,m.name,g)}}}}else{for(var f=0,h=k.length;f<h;f++){m=k[f];b=l[f];if(b.summaryType){g[m.name]=0}}}return g},renderColumnsSummary:function(d,h){h=h||this.view.getColumnData();var j=this.cm.config;var e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=this.getColumnStyle(f,null,true);a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a,d)}else{a.value=""}if(a.value!=undefined&&a.value!==""){a.attr='title="'+a.value+'"'}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.templates.columnSummaryCell.apply(a)}return this.templates.columnSummary.apply({cstyle:"width:"+(this.colsTotalWidth-1)+"px;",cells:e.join("")})},layout:function(){if(!this.mainBody){return}var e=this.grid;var i=e.getGridEl();var b=i.getSize(true);var d=b.width;if(d<20||b.height<20){return}if(e.autoHeight){this.scroller.dom.style.overflow="visible"}else{this.el.setSize(b.width,b.height);var h=this.mainHd.getHeight();var a=this.cm.getColumnCount(true)*this.colWidth;var f=(a+this.scrollOffset);this.scroller.setSize(d-this.headerWidth-this.colsTotalWidth,f);if(this.innerHd){this.innerHd.style.width=this.getTotalWidth();this.innerHd.style.height=a+"px";this.mainHd.setWidth(this.headerWidth)}if(this.innerColumnSummary){this.innerColumnSummary.style.width=(this.colsTotalWidth-1)+"px";this.innerColumnSummary.style.height=a+"px";this.mainColumnsummary.setWidth(this.colsTotalWidth-1)}}if(this.forceFit){if(this.lastViewWidth!=d){this.fitColumns(false,false);this.lastViewWidth=d}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(d,f)},onColumnWidthUpdated:function(c,a,b){this.doColumnsSummary()},renderHeaders:function(){var c=this.cm,f=this.templates;var e=f.hcell;var b=[],h=[],g={};for(var d=0,a=c.getColumnCount();d<a;d++){g.id=c.getColumnId(d);g.value=c.getColumnHeader(d)||"";g.style=this.getColumnStyle(d,true);g.tooltip=this.getColumnTooltip(d);if(c.config[d].align=="right"){g.istyle="padding-right:16px"}else{delete g.istyle}b[b.length]=e.apply(g)}return f.header.apply({cells:b.join(""),tstyle:"width:"+this.getTotalWidth()+";"})},doRender:function(f,h,q,a,o,v){var b=this.templates,e=b.cell,g=b.row,k=o-1;var d="width:"+this.rowsWidth+"px;";var y=[],s,z,t={},l={tstyle:d},n;for(var u=0,x=h.length;u<x;u++){n=h[u];s=[];var m=(u+a);for(var w=0;w<o;w++){z=f[w];t.id=z.id;t.css=w==0?"x-grid3-cell-first ":(w==k?"x-grid3-cell-last ":"");t.attr=t.cellAttr="";t.value=z.renderer(n.data[z.name],t,n,m,w,q);t.style=z.style;if(t.value==undefined||t.value===""){t.value="&#160;"}if(n.data[z.name]!=undefined&&n.data[z.name]!==""){t.attr='title="'+n.data[z.name]+'"'}if(n.dirty&&typeof n.modified[z.name]!=="undefined"){t.css+=" x-grid3-dirty-cell"}s[s.length]=e.apply(t)}var A=[];if(v&&((m+1)%2==0)){A[0]="x-grid3-row-alt"}if(n.dirty){A[1]=" x-grid3-dirty-row"}l.cols=o;if(this.getRowClass){A[2]=this.getRowClass(n,m,l,q)}l.alt=A.join(" ");l.cells=s.join("");y[y.length]=g.apply(l)}return y.join("")},getColumnStyle:function(a,d,c){var b=!d?(this.cm.config[a].css||""):(this.cm.config[a].headerCss||"");if(d){b+="width:"+this.getTotalWidth()+";"}else{if(c){b+="width:"+(this.colsTotalWidth-1)+"px;"}else{b+="width:"+this.getColumnWidth(a)+";"}}if(this.cm.isHidden(a)){b+="display:none;"}var e=this.cm.config[a].align;if(!d&&e){b+="text-align:"+e+";"}return b},getColumnWidth:function(a){return this.rowsWidth+"px"},getTotalWidth:function(){return this.headerWidth+"px"},fitColumns:function(d,g,e){var f=this.cm,t,m,p;var s=f.getTotalWidth(false);var k=this.grid.getGridEl().getWidth(true)-this.scrollOffset;if(k<20){return}var b=k-s;if(b===0){return false}var a=f.getColumnCount(true);var q=a-(typeof e=="number"?1:0);if(q===0){q=1;e=undefined}var l=f.getColumnCount();var j=[];var o=0;var n=0;var h;for(p=0;p<l;p++){if(!f.isHidden(p)&&!f.isFixed(p)&&p!==e){h=f.getColumnWidth(p);j.push(p);o=p;j.push(h);n+=h}}var c=(k-f.getTotalWidth())/n;while(j.length){h=j.pop();p=j.pop();f.setColumnWidth(p,Math.max(this.grid.minColumnWidth,Math.floor(h+h*c)),true)}if((s=f.getTotalWidth(false))>k){var r=q!=a?e:o;f.setColumnWidth(r,Math.max(1,f.getColumnWidth(r)-(s-k)),true)}if(d!==true){this.updateAllColumnWidths()}return true},renderRows:function(i,c){this.updateMainBodyWidth();var d=this.grid,f=d.colModel,a=d.store,j=d.stripeRows;var h=f.getColumnCount();if(a.getCount()<1){return""}var e=this.getColumnData();i=i||0;c=typeof c=="undefined"?a.getCount()-1:c;var b=a.getRange(i,c);return this.doRender(e,b,a,i,h,j)},refresh:function(b){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a);if(b===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.doColumnsSummary();this.fireEvent("refresh",this)},onUpdate:function(b,a){this.refreshRow(a);this.doColumnsSummary()},onAdd:function(c,a,b){this.insertRows(c,b,b+(a.length-1));this.doColumnsSummary()},updateMainBodyWidth:function(a){if(this.grid.store.getCount()>0&&a!==true){this.mainBody.setWidth(this.grid.store.getCount()*(this.rowsWidth+2))}},onRemove:function(d,a,b,c){this.updateMainBodyWidth(c);if(c!==true){this.fireEvent("beforerowremoved",this,b,a)}this.removeRow(b);if(c!==true){this.processRows(b);this.applyEmptyText();this.fireEvent("rowremoved",this,b,a)}if(c!==true){this.doColumnsSummary()}},onLoad:function(){this.scrollToTop();this.doColumnsSummary()},onHiddenChange:function(a,b,c){Ext.grid.VerticalGridview.superclass.onHiddenChange.call(this,a,b,c);this.doColumnsSummary()},focusRow:function(a){},focusCell:function(c,a,b){},ensureVisible:function(c,a,b){}});Ext.reg("vgrid",Ext.grid.VerticalGridview);
