if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}Ext.ns("Ext.ux.form");String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};Ext.ux.form.LovCombo=Ext.extend(Ext.form.ComboBox,{checkField:"checked",separator:",",constructor:function(a){a=a||{};a.listeners=a.listeners||{};Ext.applyIf(a.listeners,{scope:this,beforequery:this.onBeforeQuery,blur:this.onRealBlur});Ext.ux.form.LovCombo.superclass.constructor.call(this,a)},initComponent:function(){if(!this.tpl){this.tpl='<tpl for="."><div class="x-combo-list-item"><img src="'+Ext.BLANK_IMAGE_URL+'" class="ux-lovcombo-icon ux-lovcombo-icon-{[values.'+this.checkField+'?"checked":"unchecked"]}"><div class="ux-lovcombo-item-text">{'+(this.displayField||"text")+":htmlEncode}</div></div></tpl>"}Ext.ux.form.LovCombo.superclass.initComponent.apply(this,arguments);this.onLoad=this.onLoad.createSequence(function(){if(this.el){var b=this.el.dom.value;this.el.dom.value="";this.el.dom.value=b}});var a=this;if(!!a.store){a.store.on("load",function(){if(!!this.value){a.store.each(function(d){var c=this.value.split(",");for(var b=0;b<c.length;b++){if(d.data.Res_Code==c[b]){d.set(this.checkField,true)}}},this)}},this)}},initEvents:function(){Ext.ux.form.LovCombo.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},clearValue:function(){this.value="";this.setRawValue(this.value);this.store.clearFilter();this.store.each(function(a){a.set(this.checkField,false)},this);if(this.hiddenField){this.hiddenField.value=""}this.applyEmptyText()},getCheckedDisplay:function(){var a=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(a,this.separator+"")},getCheckedValue:function(b){b=b||this.valueField;var d=[];var a=this.store.snapshot||this.store.data;a.each(function(c){if(c.get(this.checkField)){d.push(c.get(b))}},this);return d.join(this.separator)},onBeforeQuery:function(a){a.query=a.query.replace(new RegExp(RegExp.escape(this.getCheckedDisplay())+"["+this.separator+"]*"),"")},onRealBlur:function(){if(!!this.list){this.list.hide()}this.setValue(this.value)},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){a.set(this.checkField,!a.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent("select",this,a,b)}},setValue:function(a){if(a){if(this.valueField){this.store.clearFilter();this.store.each(function(c){var b=!(!a.match("(^|"+this.separator+")"+RegExp.escape(c.get(this.valueField))+"("+this.separator+"|$)"));c.set(this.checkField,b)},this);if(!this.value){this.value=a}if(this.getCheckedValue().trim()!=""){this.value=this.getCheckedValue()}if(this.getCheckedDisplay().trim()!=""){this.setRawValue(this.getCheckedDisplay())}if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=a;this.setRawValue(a);if(this.hiddenField){this.hiddenField.value=a}}if(this.el){this.el.removeClass(this.emptyClass)}}else{this.clearValue()}},selectAll:function(){this.store.each(function(a){a.set(this.checkField,true)},this);this.doQuery(this.allQuery);this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()},beforeBlur:function(){},assertValue:Ext.emptyFn});Ext.reg("lovcombo",Ext.ux.form.LovCombo);

